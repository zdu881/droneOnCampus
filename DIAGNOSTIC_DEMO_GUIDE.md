# 诊断模块演示页面完全指南

## 📋 文档概览

`diagnostic-demo.html` 是一个功能完整的诊断模块 LED 指示灯演示系统，用于：
- ✅ 演示三色 LED 指示灯的状态转换
- ✅ 测试四种错误场景的告警流程
- ✅ 验证颜色映射的正确性
- ✅ 记录和分析处理过程
- ✅ 导出完整的日志数据

---

## 🚀 快速开始

### 1. 打开演示页面

```bash
# 在浏览器中打开
file:///data/home/sim6g/rayCode/droneOnCampus/diagnostic-demo.html

# 或通过 Web 服务器
http://localhost:8000/diagnostic-demo.html
```

### 2. 执行演示场景

点击"测试场景"卡片中的按钮：

| 按钮 | 功能 | 路径 |
|------|------|------|
| ✓ 正常完成 | 演示完整的成功流程 | 绿→黄→黄→绿 |
| ✗ 本地处理错误 | 演示本地处理失败 | 绿→黄→红 |
| ✗ 云服务拒绝 | 演示云端处理失败 | 绿→黄→黄→红 |
| ✗ 网络错误 | 演示网络连接失败 | 绿→黄→红 |

---

## 🎨 功能详解

### 1. LED 指示灯状态

#### 状态颜色映射

| 状态 | 颜色 | UE 代码 | 含义 | 说明 |
|------|------|--------|------|------|
| **initializing** | 🟢 绿色 | 1 | 初始化 | 系统准备就绪，等待任务 |
| **local_processing** | 🟡 黄色 | 2 | 本地处理 | 执行本地 CM-ZSB 推理 |
| **cloud_processing** | 🟡 黄色 | 2 | 云端处理 | 上传至云端进行处理 |
| **completed** | 🟢 绿色 | 1 | 完成 | 所有处理已完成 |
| **error** | 🔴 红色 | 0 | 错误 | 发生错误，需要处理 |

#### 颜色 CSS 值

```css
绿色 (Green)   → #10b981  (成功、正常状态)
黄色 (Yellow)  → #f59e0b  (处理中、警告)
红色 (Red)     → #ef4444  (错误、失败)
```

### 2. 三个基站指示灯

页面显示三个基站的 LED 指示灯状态：

- **基站 1** - 用于演示诊断模块状态
- **基站 2** - 同步显示 (一般用于多基站场景)
- **基站 3** - 同步显示 (一般用于多基站场景)

### 3. 进度条显示

在处理过程中，进度条会实时显示：
- 📊 处理进度百分比（0-100%）
- 📝 当前处理阶段描述
- ⏱️ 实时进度更新

### 4. 状态转换历史

页面左侧维护"状态转换历史"列表，记录：
- ⏰ 转换时间戳
- 🔖 状态标签 (颜色编码)
- 📄 转换描述信息

---

## 📊 统计面板

页面自动统计演示过程的数据：

| 统计项 | 说明 | 更新频率 |
|-------|------|--------|
| 总处理次数 | 执行的演示场景总数 | 每个场景结束 |
| 成功完成 | 成功完成的场景数 | 场景成功时更新 |
| 错误数量 | 出现错误的场景数 | 场景失败时更新 |
| 平均耗时 | 所有场景的平均处理时间 | 每个场景结束 |

**示例统计：**
```
总处理次数: 4
成功完成: 1
错误数量: 3
平均耗时: 8235ms
```

---

## ⚙️ 高级选项

### 模拟设置

点击"高级选项"卡片可配置以下选项：

#### 1. 启用云处理模拟 ✅
- 默认：启用
- 说明：演示中包含云端处理阶段（yellow 状态）
- 关闭时：跳过云处理阶段，直接进入完成或错误

#### 2. 随机错误注入 ✅
- 默认：启用
- 说明：在部分演示中随机注入错误
- 关闭时：演示按预定义流程进行

#### 3. 详细日志输出
- 默认：关闭
- 说明：启用时，每条日志都输出到浏览器控制台
- 用途：调试和深入分析

#### 4. API 集成模式
- 默认：关闭
- 说明：启用时，演示会尝试调用实际的 `apiManager` 接口
- 前提条件：需要在 dashboard.html 中加载 dashboard-manager.js

---

## 🎮 快速操作

### 导出日志 📥

点击"导出日志"按钮，将日志和统计信息导出为 TXT 文件：

```
文件名格式: diagnostic-log-[时间戳].txt
包含内容:
  ├─ 导出时间
  ├─ 统计摘要
  └─ 完整日志记录
```

导出文件示例：
```
════════════════════════════════════════
诊断模块演示 - 日志导出
时间: 2025/1/1 14:30:45
════════════════════════════════════════

【统计信息】
总处理次数: 4
成功完成: 1
错误数量: 3
平均耗时: 8235ms

════════════════════════════════════════
【详细日志】
════════════════════════════════════════
[HH:MM:SS] [系统] 诊断演示系统启动完成
...
```

### 显示详情 ℹ️

点击"显示详情"按钮，切换详情面板显示状态：

**详情面板包含：**
- 系统状态 - 当前系统运行状态
- 当前模式 - 演示/API集成模式
- API 连接 - API 连接状态
- 最后操作 - 最后执行的操作和时间
- 处理时间范围 - 最小和最大处理时间

### 测试颜色映射 🎨

点击"测试颜色映射"按钮，依次测试所有颜色：

执行流程：
```
initializing (绿)  → 800ms延迟
local_processing (黄) → 800ms延迟
cloud_processing (黄) → 800ms延迟
completed (绿)     → 800ms延迟
error (红)         → 返回绿色
```

**验证要点：**
- ✅ 颜色转换是否正确
- ✅ CSS 样式应用是否正确
- ✅ UE 灯光同步是否正常

### 自动测试 🤖

点击"自动测试"按钮，依次执行所有四个演示场景：

执行顺序：
```
1. 正常完成流程   (约10秒)
   ↓ 延迟2秒
2. 本地处理错误   (约5秒)
   ↓ 延迟2秒
3. 云服务拒绝     (约10秒)
   ↓ 延迟2秒
4. 网络连接错误   (约8秒)
   ↓
最终汇总统计
```

**自动测试好处：**
- 一键完成所有场景演示
- 自动生成完整的统计数据
- 便于全面测试系统功能

---

## 📝 日志记录

### 日志类型

| 类型 | 颜色 | 用途 | 示例 |
|------|------|------|------|
| **info** | 🔵 蓝色 | 信息记录 | `指示灯已重置为待命状态` |
| **success** | 🟢 绿色 | 成功事件 | `检测任务完成` |
| **warning** | 🟡 黄色 | 警告信息 | `云端上传: 15 个样本` |
| **error** | 🔴 红色 | 错误事件 | `本地推理出错: 样本预处理失败` |

### 日志格式

```
[HH:MM:SS] [类型] 消息内容

示例：
[14:30:45] [成功] 检测任务完成
[14:30:46] [错误] 本地推理出错: 样本预处理失败
```

### 日志容量

- 日志容器最大高度：300px
- 自动滚动到最新日志
- 点击"清除日志"重置所有记录

---

## 🔍 错误演示详解

### 1. 本地处理错误 (LOCAL_PROCESS_ERROR)

**路径：** 绿 → 黄(本地) → 红

**演示流程：**
```
状态变化:
  初始化(绿)    [0-30%]
  ↓
  本地处理(黄)  [30-50%]
  ↓
  中断处理      [50-55%]
  ↓
  错误(红)      [闪烁]

日志内容:
- CM-ZSB 服务初始化完成
- 开始本地推理
- 本地推理出错: 样本预处理失败
- 错误详情: 样本数据格式不正确或损坏
- 建议: 请检查数据源或重新采集样本
```

**错误类型：** 数据格式错误、内存不足、计算错误

---

### 2. 云服务拒绝 (CLOUD_REJECTION)

**路径：** 绿 → 黄(本地) → 黄(云) → 红

**演示流程：**
```
状态变化:
  初始化(绿)    [0-25%]
  ↓
  本地处理(黄)  [25-65%]
  ↓
  云端处理(黄)  [65-75%]
  ↓
  错误(红)      [闪烁]

日志内容:
- CM-ZSB 服务初始化完成
- 本地推理完成: 高置信度 25, 低置信度 25
- 检测到 25 个低置信度样本, 需要云处理
- 云端上传: 25 个样本
- 云服务拒绝: 低置信度样本数量超过阈值
- 错误代码: CLOUD_REJECTION (置信度 < 0.7)
- 建议: 请重新采集更高质量的样本数据
```

**拒绝原因：**
- 置信度过低 (< 0.7)
- 样本质量不达标
- 云端负载过高
- API 限流

---

### 3. 网络错误 (NETWORK_ERROR)

**路径：** 绿 → 黄(本地) → 黄(准备) → 红

**演示流程：**
```
状态变化:
  初始化(绿)    [0-30%]
  ↓
  本地处理(黄)  [30-60%]
  ↓
  云端准备(黄)  [60-65%]
  ↓
  错误(红)      [闪烁]

日志内容:
- CM-ZSB 服务初始化完成
- 本地推理完成: 高置信度 80, 低置信度 20
- 准备云端处理
- 网络错误: 无法连接到云端服务器
- 错误详情: 连接超时 (30000ms) - 请检查网络连接
- 建议: 检查网络设置或稍后重试
```

**网络问题：**
- 连接超时
- DNS 解析失败
- 服务器无响应
- 网络中断

---

## 🔧 API 集成

### 启用 API 集成模式

1. 勾选"高级选项"中的"API 集成模式"
2. 确保 `window.apiManager` 已加载
3. 运行演示场景

### API 调用

启用 API 模式时，演示会调用：

```javascript
window.apiManager.changeBaseStationLight(lightIndex, colorCode)

参数说明:
- lightIndex: 基站编号 (0, 1, 2, ...)
- colorCode: 颜色代码
  └─ 0: 红色 (Red)
  └─ 1: 绿色 (Green)
  └─ 2: 黄色 (Yellow)
```

**集成位置：**
```javascript
// dashboard-manager.js 中的调用
window.apiManager.changeBaseStationLight(0, 1);  // 基站1显示绿色
window.apiManager.changeBaseStationLight(0, 2);  // 基站1显示黄色
window.apiManager.changeBaseStationLight(0, 0);  // 基站1显示红色
```

---

## 💻 浏览器控制台

### 启用详细日志

在"高级选项"中勾选"详细日志输出"，所有日志也会输出到浏览器控制台。

### 控制台查看方法

```
1. 打开演示页面
2. 按下 F12 打开开发者工具
3. 切换到"Console"标签
4. 执行演示场景
5. 查看详细日志输出
```

### 控制台示例

```
[INFO] 诊断演示系统启动完成
[INFO] 系统版本: 1.2 | 支持 API 集成、自动测试、日志导出
[INFO] API Manager 已连接
[INFO] 开始演示: 正常完成流程
[INFO] 指示灯切换: 待命
[SUCCESS] CM-ZSB 服务初始化完成
[INFO] 指示灯切换: 本地处理
...
```

---

## 📱 响应式设计

### 桌面版本 (> 768px)

- **布局：** 双列网格（指示灯 + 测试场景）
- **统计面板：** 4 列网格
- **选项按钮：** 自动分布

### 移动版本 (≤ 768px)

- **布局：** 单列堆叠
- **统计面板：** 2 列网格
- **选项按钮：** 单列垂直

---

## 🎯 使用场景

### 场景 1: 验证颜色映射

**目标：** 确保前端、CSS、UE 引擎的颜色一致

**步骤：**
```
1. 点击"测试颜色映射"
2. 观察各颜色转换
3. 对比 UE 引擎的灯光变化
4. 确认映射正确
```

---

### 场景 2: 测试错误告警

**目标：** 验证四种错误情况的告警流程

**步骤：**
```
1. 依次点击四个错误场景按钮
2. 观察错误类型和日志
3. 检查红色灯光闪烁
4. 验证错误信息完整性
```

---

### 场景 3: 完整系统演示

**目标：** 向非技术人员展示整个系统流程

**步骤：**
```
1. 点击"自动测试"按钮
2. 让系统自动执行所有场景
3. 在统计面板查看结果
4. 导出日志作为演示记录
```

---

### 场景 4: 性能测试

**目标：** 测试系统处理性能

**步骤：**
```
1. 启用"详细日志输出"
2. 运行"自动测试"
3. 查看统计面板的平均耗时
4. 分析各场景的时间分布
```

---

## 🐛 故障排除

### 问题 1: 灯光颜色不正确

**症状：** 显示的颜色与预期不符

**排查步骤：**
```
1. 打开浏览器开发者工具 (F12)
2. 检查 CSS 类是否正确应用
3. 查看 .indicator-light 的样式
4. 验证 CSS 变量值
```

**可能原因：**
- CSS 文件未加载
- CSS 类名拼写错误
- 浏览器缓存问题

**解决方案：**
```
1. 清空浏览器缓存 (Ctrl+Shift+Delete)
2. 硬刷新页面 (Ctrl+Shift+R)
3. 检查 CSS 变量定义
4. 验证 <style> 标签内容
```

---

### 问题 2: API 集成不工作

**症状：** 启用 API 模式后 UE 灯光不变

**排查步骤：**
```
1. 检查 window.apiManager 是否存在
2. 查看浏览器控制台是否有错误
3. 验证 API 端点是否正确
4. 确认 UE 服务是否运行
```

**可能原因：**
- dashboard-manager.js 未加载
- API 端点不可用
- 网络连接问题
- UE 服务未启动

**解决方案：**
```javascript
// 在控制台检查 API 可用性
console.log(window.apiManager);  // 应该返回对象

// 手动测试 API 调用
window.apiManager.changeBaseStationLight(0, 1);
```

---

### 问题 3: 日志显示不完整

**症状：** 日志容器中只显示部分日志

**原因：**
- 日志数量超过容器高度
- 需要滚动查看

**解决方案：**
```
1. 在日志容器中滚动
2. 点击"导出日志"查看完整记录
3. 点击"清除日志"重新开始
```

---

## 📚 相关文件

| 文件 | 说明 |
|------|------|
| `diagnostic-demo.html` | 演示页面（当前文件） |
| `dashboard-manager.js` | 核心状态管理逻辑 |
| `ue-light-manager.js` | UE 灯光接口定义 |
| `dashboard-styles.css` | CSS 样式定义 |
| `COLOR_MAPPING_CHECK.md` | 颜色映射验证文档 |
| `DIAGNOSTIC_LED_ENHANCEMENT.md` | 技术文档 |

---

## ✅ 完善检查清单

演示页面的完善项目包括：

- ✅ **三色 LED 指示灯演示** - 绿/黄/红 完整支持
- ✅ **五种状态转换** - initializing/local/cloud/completed/error
- ✅ **四种错误场景** - 本地错误/云服务拒绝/网络错误/其他
- ✅ **进度条显示** - 实时进度反馈
- ✅ **状态历史记录** - 完整的转换历史
- ✅ **统计分析** - 成功率、错误率、平均耗时
- ✅ **日志导出** - TXT 格式导出
- ✅ **高级选项** - 模拟设置、API 集成
- ✅ **自动测试** - 一键执行所有场景
- ✅ **颜色映射参考** - 完整的对应表
- ✅ **响应式设计** - 桌面和移动适配
- ✅ **详细说明** - 完整的文档和指南

---

## 📞 技术支持

如有问题或建议，请检查：

1. **浏览器兼容性** - 推荐 Chrome/Firefox 最新版本
2. **JavaScript 控制台** - 查看是否有报错信息
3. **网络连接** - 确保 API 调用能正常进行
4. **文件路径** - 确认所有资源文件正确加载

---

**最后更新：** 2025年1月  
**版本：** 1.2  
**状态：** ✅ 完成并完善

