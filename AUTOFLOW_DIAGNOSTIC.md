#!/bin/bash
# è‡ªåŠ¨æ¨æµè¯Šæ–­è„šæœ¬

echo "=========================================="
echo "ğŸ” è‡ªåŠ¨æ¨æµå¤±è´¥è¯Šæ–­"
echo "=========================================="
echo ""

# é—®é¢˜ç—‡çŠ¶åˆ†æ
echo "ğŸ“‹ é—®é¢˜ç—‡çŠ¶:"
echo "  â€¢ Electron åº”ç”¨å·²è¿æ¥åˆ° Dashboard API âœ“"
echo "  â€¢ Dashboard ç‚¹å‡»'å¼€å§‹é£è¡Œ'å"
echo "  â€¢ Electron åº”ç”¨æ²¡æœ‰è‡ªåŠ¨æ˜¾ç¤ºåƒç´ æµ âœ—"
echo ""

echo "ğŸ” å¯èƒ½åŸå› åˆ—è¡¨:"
echo ""

echo "1ï¸âƒ£ åŸå› : Dashboard æ²¡æœ‰æˆåŠŸæ›´æ–° API çŠ¶æ€"
echo "   ç—‡çŠ¶: api-manager.js ä¸­çš„ fetch è°ƒç”¨å¤±è´¥æˆ–è¢«è·³è¿‡"
echo "   æ£€æŸ¥:"
echo "   - Dashboard æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—ï¼Ÿ"
echo "   - ç‚¹å‡»'å¼€å§‹é£è¡Œ'æ—¶æ˜¯å¦è°ƒç”¨äº† triggerDroneAction()ï¼Ÿ"
echo "   - fetch è¯·æ±‚æ˜¯å¦æˆåŠŸå‘é€åˆ° http://10.30.2.11:8000?"
echo ""

echo "2ï¸âƒ£ åŸå› : Electron çš„ drone-monitor æ²¡æœ‰æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–"
echo "   ç—‡çŠ¶: è½®è¯¢æ”¶åˆ°çš„æ•°æ®ä¸­ isFlying å§‹ç»ˆä¸º false"
echo "   æ£€æŸ¥:"
echo "   - Electron å¼€å‘å·¥å…·ä¸­æ˜¯å¦çœ‹åˆ°è½®è¯¢æ—¥å¿—ï¼Ÿ"
echo "   - è½®è¯¢æ”¶åˆ°çš„å“åº”ä¸­ isFlying å€¼æ˜¯ä»€ä¹ˆï¼Ÿ"
echo "   - æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—ï¼š'Failed to check flight status'ï¼Ÿ"
echo ""

echo "3ï¸âƒ£ åŸå› : çŠ¶æ€å˜åŒ–æ£€æµ‹é€»è¾‘æœ‰é—®é¢˜"
echo "   ç—‡çŠ¶: å³ä½¿ isFlying å˜åŒ–ï¼Œä¹Ÿæ²¡æœ‰å‘é€ 'flight:started' äº‹ä»¶"
echo "   æ£€æŸ¥:"
echo "   - drone-monitor.js ä¸­çš„çŠ¶æ€æ¯”è¾ƒé€»è¾‘"
echo "   - åˆå§‹çŠ¶æ€ this.isFlying å€¼"
echo "   - äº‹ä»¶å‘é€æ˜¯å¦æœ‰æ¡ä»¶é™åˆ¶"
echo ""

echo "4ï¸âƒ£ åŸå› : IPC é€šä¿¡å¤±è´¥"
echo "   ç—‡çŠ¶: 'flight:started' äº‹ä»¶å·²å‘é€ï¼Œä½† renderer æ²¡æœ‰æ”¶åˆ°"
echo "   æ£€æŸ¥:"
echo "   - main.js ä¸­çš„ droneMonitor.on('flight:started') ç›‘å¬å™¨æ˜¯å¦æ­£ç¡®ï¼Ÿ"
echo "   - mainWindow.webContents.send('stream:status') æ˜¯å¦æ‰§è¡Œï¼Ÿ"
echo "   - æ˜¯å¦æœ‰ 'Cannot read properties of undefined' é”™è¯¯ï¼Ÿ"
echo ""

echo "5ï¸âƒ£ åŸå› : Renderer è¿›ç¨‹æ²¡æœ‰æ­£ç¡®å¤„ç†äº‹ä»¶"
echo "   ç—‡çŠ¶: å³ä½¿æ”¶åˆ° IPC æ¶ˆæ¯ï¼Œä¹Ÿæ²¡æœ‰åˆ›å»º iframe"
echo "   æ£€æŸ¥:"
echo "   - renderer.js ä¸­çš„ window.electronAPI.onStreamStatus æ˜¯å¦è§¦å‘ï¼Ÿ"
echo "   - æ˜¯å¦è°ƒç”¨äº† startDisplayingStream()ï¼Ÿ"
echo "   - DOM ä¸­æ˜¯å¦æˆåŠŸæ’å…¥äº† iframe å…ƒç´ ï¼Ÿ"
echo ""

echo "=========================================="
echo "ğŸ› ï¸ å¿«é€Ÿè°ƒè¯•æ­¥éª¤"
echo "=========================================="
echo ""

echo "ç¬¬ 1 æ­¥: åœ¨ Electron ä¸­æ‰“å¼€å¼€å‘å·¥å…·"
echo "  å¿«æ·é”®: Ctrl + Shift + I æˆ– F12"
echo ""

echo "ç¬¬ 2 æ­¥: è¿›å…¥ Console æ ‡ç­¾ï¼ŒæŸ¥çœ‹å®Œæ•´æ—¥å¿—"
echo "  é¢„æœŸçœ‹åˆ°çš„æ—¥å¿—åºåˆ—:"
echo "  âœ“ 'ğŸ“ Dashboard URL: http://10.30.2.11:8000'"
echo "  âœ“ 'ğŸ¯ Starting flight monitor'"
echo "  âœ“ è¿ç»­çš„è½®è¯¢æ—¥å¿—"
echo "  [åœ¨ Dashboard ç‚¹å‡»'å¼€å§‹é£è¡Œ']"
echo "  âœ“ 'âœˆï¸ DRONE FLIGHT STARTED'"
echo "  âœ“ 'ğŸ¬ Starting pixel stream'"
echo "  âœ“ 'ğŸ“Š çŠ¶æ€: streaming'"
echo ""

echo "ç¬¬ 3 æ­¥: å¦‚æœç¼ºå°‘æŸä¸ªæ—¥å¿—ï¼Œæ’æŸ¥å¯¹åº”éƒ¨åˆ†"
echo "  å¦‚æœç¼ºå°‘'âœˆï¸ DRONE FLIGHT STARTED':"
echo "    â†’ é—®é¢˜åœ¨ drone-monitor.js çš„çŠ¶æ€æ£€æµ‹"
echo ""
echo "  å¦‚æœç¼ºå°‘'ğŸ¬ Starting pixel stream':"
echo "    â†’ é—®é¢˜åœ¨ main.js çš„äº‹ä»¶ç›‘å¬å™¨"
echo ""
echo "  å¦‚æœç¼ºå°‘'ğŸ“Š çŠ¶æ€: streaming':"
echo "    â†’ é—®é¢˜åœ¨ renderer.js çš„ IPC äº‹ä»¶å¤„ç†"
echo ""

echo "=========================================="
echo "ğŸ”§ å…³é”®ä»£ç æ£€æŸ¥"
echo "=========================================="
echo ""

echo "âœ“ æ£€æŸ¥ api-manager.js:triggerDroneAction()"
echo "  åº”è¯¥åŒ…å«:"
echo "  await fetch('http://10.30.2.11:8000/api/drone/status', {"
echo "    method: 'PUT',"
echo "    body: JSON.stringify({isFlying: true})"
echo "  })"
echo ""

echo "âœ“ æ£€æŸ¥ drone-monitor.js:checkFlightStatus()"
echo "  åº”è¯¥åŒ…å«:"
echo "  const nowFlying = data.isFlying === true;"
echo "  if (nowFlying && !this.isFlying) {"
echo "    this.emit('flight:started', ...);"
echo "  }"
echo ""

echo "âœ“ æ£€æŸ¥ main.js åˆå§‹åŒ–"
echo "  åº”è¯¥åŒ…å«:"
echo "  droneMonitor.on('flight:started', () => {"
echo "    mainWindow.webContents.send('stream:status', {...});"
echo "  });"
echo ""

echo "âœ“ æ£€æŸ¥ renderer.js"
echo "  åº”è¯¥åŒ…å«:"
echo "  window.electronAPI.onStreamStatus((event, data) => {"
echo "    if (data.status === 'streaming') {"
echo "      this.startDisplayingStream();"
echo "    }"
echo "  });"
echo ""

echo "=========================================="
echo "ğŸ§ª æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤"
echo "=========================================="
echo ""

echo "ç¬¬ 1 æ­¥: åœ¨ API æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨è®¾ç½® isFlying=true"
echo "  $ curl -X PUT http://10.30.2.11:8000/api/drone/status \\"
echo "    -H 'Content-Type: application/json' \\"
echo "    -d '{\"isFlying\": true, \"status\": \"flying\"}'"
echo ""

echo "ç¬¬ 2 æ­¥: è§‚å¯Ÿ Electron åº”ç”¨"
echo "  é¢„æœŸ: åº”è¯¥è‡ªåŠ¨æ˜¾ç¤ºåƒç´ æµ"
echo "  å¦‚æœæ²¡æœ‰: è¯´æ˜é—®é¢˜åœ¨æ£€æµ‹æˆ– IPC é“¾è·¯"
echo ""

echo "ç¬¬ 3 æ­¥: é‡ç½®çŠ¶æ€"
echo "  $ curl -X PUT http://10.30.2.11:8000/api/drone/status \\"
echo "    -H 'Content-Type: application/json' \\"
echo "    -d '{\"isFlying\": false, \"status\": \"idle\"}'"
echo ""

echo "=========================================="
